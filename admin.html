<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… - Ù…Ø¨Ø§Ø¯Ø±Ø© ØµÙ‚Ø±</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="toast"></div>
<div class="watermark"></div>

<header>
    <div style="display: flex; align-items: center; gap: 15px;">
        <img src="logo.png" class="logo-header">
        <h3 style="margin: 0; font-weight: 900;">Ø¥Ø¯Ø§Ø±Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø¯Ø±Ø©</h3>
    </div>
    <button class="btn-gold" style="width: auto; background: rgba(255,255,255,0.1); color: #fff;" onclick="location.href='home.html'">â¬…ï¸ Ø¹ÙˆØ¯Ø©</button>
</header>

<div class="container" style="padding: 25px; max-width: 600px; margin: 0 auto;">
    <div class="glass-card">
        <h2 style="color: var(--gold); margin-top: 0;">ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h2>
        <p style="opacity: 0.8; font-size: 14px; margin-bottom: 20px;">Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Users Ø§Ù„Ù…Ø¹ØªÙ…Ø¯.</p>

        <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ (ID)</label>
        <input type="text" id="newID" placeholder="Ù…Ø«Ù„Ø§Ù‹: 1005">

        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="newName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">

        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="newEmail" placeholder="example@mail.com">

        <label>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</label>
        <select id="newRole">
            <option value="sales">Ù…Ù†Ø¯ÙˆØ¨ Ù…ÙŠØ¯Ø§Ù†ÙŠ</option>
            <option value="ceo">Ø±Ø¦ÙŠØ³ ØªÙ†ÙÙŠØ°ÙŠ (CEO)</option>
            <option value="admin">Ù…Ø¯ÙŠØ± Ù†Ø¸Ø§Ù… (Admin)</option>
        </select>

        <button class="btn-gold" id="addBtn" onclick="addUser()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¢Ù†</button>
    </div>
</div>

<script>
    const API = "https://script.google.com/macros/s/AKfycbzPMNYU_Q0nTlF8OI6Js4NfXbKjre4I5YspWlg8OdJMa7O1_IZiNjZsvqdfjaPsz46o/exec";

    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }

    async function addUser() {
        const btn = document.getElementById('addBtn');
        const data = {
            action: 'addUser',
            newID: document.getElementById('newID').value,
            newName: document.getElementById('newName').value,
            newEmail: document.getElementById('newEmail').value,
            newRole: document.getElementById('newRole').value
        };

        if (!data.newID || !data.newName) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©");

        btn.disabled = true;
        btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...";
        
        try {
            const response = await fetch(API, {
                method: 'POST',
                body: JSON.stringify(data)
            });
            const res = await response.json();

            if (res.success) {
                showToast("âœ… " + res.msg);
                // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
                document.getElementById('newID').value = '';
                document.getElementById('newName').value = '';
                document.getElementById('newEmail').value = '';
            } else {
                alert("Ø®Ø·Ø£: " + res.msg);
            }
        } catch (error) {
            alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.");
        } finally {
            btn.disabled = false;
            btn.innerText = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¢Ù†";
        }
    }

    // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©: Ù„Ø§ ÙŠÙØªØ­Ù‡Ø§ Ø¥Ù„Ø§ Ø§Ù„Ø£Ø¯Ù…Ù†
    if (sessionStorage.getItem('userRole') !== 'admin') {
        alert("Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙ‚Ø·");
        window.location.href = "home.html";
    }
</script>

</body>
</html>
